<Window x:Class="AntMissionManager.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:views="clr-namespace:AntMissionManager.Views"
        xmlns:models="clr-namespace:AntMissionManager.Models"
        Title="ANT Mission Manager"
        Height="900" Width="1400"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">

    <Border CornerRadius="12" Background="{StaticResource DarkBackground}">
        <Border.Effect>
            <DropShadowEffect Color="Black" Direction="270" ShadowDepth="10" Opacity="0.5" BlurRadius="30"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="35"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="{StaticResource CardBackground}" CornerRadius="12,12,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Margin="16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="Robot" Width="16" Height="16" Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="ANT Mission Manager"
                                  FontSize="13"
                                  FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"
                                  VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Content="_"
                               Width="40" Height="30"
                               Background="Transparent"
                               BorderThickness="0"
                               Foreground="{StaticResource MutedText}"
                               FontSize="16"
                               FontWeight="Bold"
                               Cursor="Hand"
                               Click="MinimizeButton_Click"
                               Margin="0,0,4,0">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-8,0,0"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource SurfaceBackground}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button Content="□"
                               Width="40" Height="30"
                               Background="Transparent"
                               BorderThickness="0"
                               Foreground="{StaticResource MutedText}"
                               FontSize="14"
                               FontWeight="Bold"
                               Cursor="Hand"
                               Click="MaximizeButton_Click"
                               Margin="0,0,4,0">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource SurfaceBackground}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button Content="✕"
                               Width="40" Height="30"
                               Background="Transparent"
                               BorderThickness="0"
                               Foreground="{StaticResource MutedText}"
                               FontSize="16"
                               FontWeight="Bold"
                               Cursor="Hand"
                               Click="CloseButton_Click">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

        <!-- Logout Bar -->
        <Border Grid.Row="1" Background="{StaticResource DarkBackground}" Margin="12,0">
            <Grid>
                <Button Content="Logout"
                        Width="100"
                        Height="32"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Center"
                       Style="{StaticResource ModernPrimaryButton}"
                       Command="{Binding LogoutCommand}"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <TabControl Grid.Row="2"
                   Background="Transparent"
                   Margin="16,3,16,0">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border Name="Border" 
                                       Background="Transparent" 
                                       BorderThickness="0" 
                                       CornerRadius="12,12,0,0"
                                       Margin="0,0,4,0"
                                       Padding="20,12">
                                    <ContentPresenter x:Name="ContentSite"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    ContentSource="Header"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="{StaticResource CardBackground}"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="{StaticResource SurfaceBackground}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>
            
            <!-- Mission Dashboard Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ViewDashboard" Width="18" Height="18" 
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Mission Dashboard" 
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="110"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Control Panel -->
                    <Border Grid.Row="0" Background="{StaticResource SurfaceBackground}" 
                           Padding="24" Margin="0,0,0,16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal" Grid.Column="0">
                                <Border Background="{StaticResource CardBackground}" 
                                       Margin="0,0,12,0"
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <ComboBox Background="Transparent"
                                              BorderThickness="0"
                                              Foreground="{StaticResource PrimaryText}"
                                              Width="220"
                                              Padding="12,8"
                                              ItemsSource="{Binding MissionFilterOptions}"
                                              SelectedItem="{Binding SelectedMissionFilter, Mode=TwoWay}"
                                              DisplayMemberPath="DisplayName"
                                              materialDesign:HintAssist.Hint="상태 필터"
                                              materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <Border Background="{StaticResource CardBackground}" 
                                       Margin="0,0,12,0"
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                <DatePicker SelectedDate="{Binding MissionFilterStart, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource MissionDatePickerStyle}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Foreground="{StaticResource PrimaryText}"
                                            Width="180"
                                            Margin="12,8"
                                                materialDesign:HintAssist.Hint="조회 시작 시간"
                                                materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <Border Background="{StaticResource CardBackground}" 
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                <DatePicker SelectedDate="{Binding MissionFilterEnd, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource MissionDatePickerStyle}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Foreground="{StaticResource PrimaryText}"
                                            Width="180"
                                            Margin="12,8"
                                                materialDesign:HintAssist.Hint="조회 종료 시간"
                                                materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Grid.Column="3" HorizontalAlignment="Right">
                                <Border Background="{StaticResource CardBackground}" 
                                        Width="180"
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1" Margin="0,0,12,0">
                                    <Grid Margin="12,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <materialDesign:PackIcon Kind="Magnify" Width="18" Height="18"
                                                               Foreground="{StaticResource MutedText}"
                                                               VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding MissionSearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Margin="8,0,0,0"
                                                 materialDesign:HintAssist.Hint="미션 검색"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}"
                                                 VerticalContentAlignment="Center"/>
                                    </Grid>
                                </Border>

                                <Button Content="검색 초기화"
                                        Width="100"
                                       Style="{StaticResource ModernPrimaryButton}"
                                       Command="{Binding ClearMissionSearchCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Statistics Cards -->
                    <Grid Grid.Row="1" Margin="24,0,24,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Total Missions Card -->
                        <Border Grid.Column="0" Style="{StaticResource GlassCard}" Margin="0,0,8,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <Border Background="{StaticResource PrimaryBrush}"
                                            Width="40" Height="40"
                                            CornerRadius="20">
                                        <materialDesign:PackIcon Kind="FormatListBulleted" Width="20" Height="20"
                                                                 Foreground="White" HorizontalAlignment="Center"
                                                                 VerticalAlignment="Center" />
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Total" Style="{StaticResource CaptionText}" />
                                        <TextBlock Text="Missions" Style="{StaticResource CaptionText}"
                                                   Margin="0,-2,0,0" />
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="{Binding TotalMissions}"
                                           FontSize="32" FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryText}"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>
                        
                        <!-- Running Missions Card -->
                        <Border Grid.Column="1" Style="{StaticResource GlassCard}" Margin="8,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <Border Background="{StaticResource SuccessBrush}"
                                            Width="40" Height="40"
                                            CornerRadius="20">
                                        <materialDesign:PackIcon Kind="Play" Width="20" Height="20"
                                                                 Foreground="White" HorizontalAlignment="Center"
                                                                 VerticalAlignment="Center" />
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Active" Style="{StaticResource CaptionText}" />
                                        <TextBlock Text="Running" Style="{StaticResource CaptionText}"
                                                   Margin="0,-2,0,0" />
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="{Binding RunningMissions}"
                                           FontSize="32" FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryText}"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>
                        
                        <!-- Pending Missions Card -->
                        <Border Grid.Column="2" Style="{StaticResource GlassCard}" Margin="8,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <Border Background="{StaticResource WarningBrush}"
                                            Width="40" Height="40"
                                            CornerRadius="20">
                                        <materialDesign:PackIcon Kind="Clock" Width="20" Height="20"
                                                                 Foreground="White" HorizontalAlignment="Center"
                                                                 VerticalAlignment="Center" />
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Pending" Style="{StaticResource CaptionText}" />
                                        <TextBlock Text="Waiting" Style="{StaticResource CaptionText}"
                                                   Margin="0,-2,0,0" />
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="{Binding PendingMissions}"
                                           FontSize="32" FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryText}"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>
                        
                        <!-- Completed Missions Card -->
                        <Border Grid.Column="3" Style="{StaticResource GlassCard}" Margin="8,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <Border Background="{StaticResource AccentBrush}"
                                            Width="40" Height="40"
                                            CornerRadius="20">
                                        <materialDesign:PackIcon Kind="CheckCircle" Width="20" Height="20"
                                                                 Foreground="White" HorizontalAlignment="Center"
                                                                 VerticalAlignment="Center" />
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Done" Style="{StaticResource CaptionText}" />
                                        <TextBlock Text="Completed" Style="{StaticResource CaptionText}"
                                                   Margin="0,-2,0,0" />
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="{Binding CompletedMissions}"
                                           FontSize="32" FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryText}"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>

                        <!-- Cancelled Missions Card -->
                        <Border Grid.Column="4" Style="{StaticResource GlassCard}" Margin="8,0,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <Border Background="{StaticResource ErrorBrush}"
                                            Width="40" Height="40"
                                            CornerRadius="20">
                                        <materialDesign:PackIcon Kind="CloseCircle" Width="20" Height="20"
                                                                 Foreground="White" HorizontalAlignment="Center"
                                                                 VerticalAlignment="Center" />
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Cancelled" Style="{StaticResource CaptionText}" />
                                        <TextBlock Text="Missions" Style="{StaticResource CaptionText}"
                                                   Margin="0,-2,0,0" />
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="{Binding CancelledMissions}"
                                           FontSize="32" FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryText}"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>
                    </Grid>
                    
                    <!-- Mission List -->
                    <Border Grid.Row="2" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource AccentBrush}" 
                                       Width="40" Height="40" 
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="FormatListBulleted" Width="20" Height="20" 
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Mission Queue" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="Active and pending missions" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}" 
                                   CornerRadius="12" 
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid x:Name="MissionDataGrid"
                                         ItemsSource="{Binding MissionView}"
                                         Style="{StaticResource AppDataGridStyle}"
                                         RowHeight="45"
                                         ColumnHeaderStyle="{StaticResource CenteredDataGridHeaderStyle}"
                                         CellStyle="{StaticResource CenteredDataGridCellStyle}"
                                         Sorting="MissionDataGrid_Sorting"
                                         Loaded="MissionDataGrid_Loaded">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Mission ID" Binding="{Binding MissionId}" Width="0.8*" SortMemberPath="MissionIdSortValue" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding MissionType}" Width="1.2*" SortMemberPath="MissionType" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="From" Binding="{Binding FromNode}" Width="*" SortMemberPath="FromNode" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="To" Binding="{Binding ToNode}" Width="*" SortMemberPath="ToNode" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="Vehicle" Binding="{Binding AssignedVehicle}" Width="1.1*" SortMemberPath="AssignedVehicle" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="Nav Status" Width="1.3*" SortMemberPath="NavigationStateText" Binding="{Binding NavigationStateText}" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="Transport" Binding="{Binding TransportStateText}" Width="1.1*" SortMemberPath="TransportStateText" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="0.7*" SortMemberPath="Priority" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedAtDisplay}" Width="1.5*" SortMemberPath="CreatedAt" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTemplateColumn Header="Actions" Width="*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Cancel" 
                                                           Background="{StaticResource ErrorBrush}"
                                                           Foreground="White"
                                                           BorderThickness="0"
                                                           Height="28"
                                                           Padding="12,4"
                                                           FontSize="11"
                                                           Cursor="Hand"
                                                           Command="{Binding DataContext.CancelMissionCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                           CommandParameter="{Binding MissionId}"
                                                           Visibility="{Binding CanCancel, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                        <Button.Style>
                                                            <Style TargetType="Button">
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate TargetType="Button">
                                                                            <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                            </Border>
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Background" Value="#DC2626"/>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
            
            <!-- Mission Router Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="MapMarker" Width="18" Height="18" 
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Mission Router" 
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="300"/>
                    </Grid.ColumnDefinitions>

                    <!-- Background for deselection -->
                    <Border Grid.ColumnSpan="2" Background="Transparent" MouseLeftButtonDown="TemplateGridBackground_MouseLeftButtonDown"/>

                        <!-- Template List -->
                    <Border Grid.Column="0" Style="{StaticResource GlassCard}" Margin="16,24,6,24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <Border Background="{StaticResource AccentBrush}"
                                           Width="40" Height="40"
                                           CornerRadius="20"
                                           Margin="0,0,12,0">
                                        <materialDesign:PackIcon Kind="FormatListBulleted" Width="20" Height="20"
                                                               Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center" Margin="0,0,25,0">
                                        <TextBlock Text="미션 경로 리스트" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                        <TextBlock Text="경로를 미리 등록하세요" Style="{StaticResource CaptionText}" Margin="0"/>
                                    </StackPanel>

                                    <!-- Title Filter -->
                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="12"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           VerticalAlignment="Center">
                                        <ComboBox SelectedValue="{Binding SelectedTemplateFilter}"
                                                 ItemsSource="{Binding TemplateTitles}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Width="240"
                                                 Padding="12,12"
                                                 IsEditable="True"
                                                 IsTextSearchEnabled="True"
                                                 StaysOpenOnEdit="True"
                                                 materialDesign:HintAssist.Hint="Filter by Title"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                    </Border>
                                </StackPanel>

                                <!-- Import/Export Buttons -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Button Content="불러오기"
                                           Width="80"
                                           Style="{StaticResource ModernPrimaryButton}"
                                           Command="{Binding ImportTemplatesCommand}"
                                           Margin="0,0,8,0"/>
                                    <Button Content="내보내기"
                                           Width="80"
                                           Style="{StaticResource ModernPrimaryButton}"
                                           Command="{Binding ExportTemplatesCommand}"/>
                                </StackPanel>
                            </Grid>

                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}"
                                   CornerRadius="12"
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid ItemsSource="{Binding TemplateView}"
                                         SelectedItem="{Binding SelectedTemplate, Mode=TwoWay}"
                                         Style="{StaticResource AppDataGridStyle}"
                                         RowHeight="45"
                                         SelectionMode="Single"
                                         ColumnHeaderStyle="{StaticResource CenteredDataGridHeaderStyle}"
                                         CellStyle="{StaticResource CenteredDataGridCellStyle}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="제목" Binding="{Binding Title}" Width="1.2*" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="타입" Binding="{Binding TemplateTypeName}" Width="0.7*" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="경로" Binding="{Binding RouteDisplay}" Width="1.7*" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="차량" Binding="{Binding Vehicle}" Width="0.8*" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="우선순위" Binding="{Binding Priority}" Width="0.7*" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="설명" Binding="{Binding PriorityDescription}" Width="3.3*" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                    
                    <!-- Template Creation -->
                    <Border Grid.Column="1" Style="{StaticResource GlassCard}" Margin="12,24,16,24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                                    <Border Background="{StaticResource SuccessBrush}"
                                           Width="40" Height="40"
                                           CornerRadius="20"
                                           Margin="0,0,12,0">
                                        <materialDesign:PackIcon Kind="Plus" Width="20" Height="20"
                                                               Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="경로 등록" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Template Name -->
                                <Border Background="{StaticResource SurfaceBackground}"
                                       CornerRadius="10"
                                       Margin="0,0,0,14"
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <TextBox Text="{Binding TemplateTitle}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Foreground="{StaticResource PrimaryText}"
                                            FontSize="14"
                                            Padding="16,12"
                                            materialDesign:HintAssist.Hint="Title"
                                            materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <!-- Mission Type -->
                                <Border Background="{StaticResource SurfaceBackground}"
                                       CornerRadius="10"
                                       Margin="0,0,0,12"
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <ComboBox SelectedValue="{Binding SelectedTemplateType}"
                                             SelectedValuePath="Tag"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Padding="16,12"
                                             materialDesign:HintAssist.Hint="Mission Type"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}">
                                        <ComboBoxItem Content="무빙 미션" Tag="{x:Static models:MissionTemplateType.Moving}" Foreground="{StaticResource PrimaryText}"/>
                                        <ComboBoxItem Content="픽앤드롭 미션" Tag="{x:Static models:MissionTemplateType.PickAndDrop}" Foreground="{StaticResource PrimaryText}"/>
                                        <ComboBoxItem Content="다이나믹 미션" Tag="{x:Static models:MissionTemplateType.Dynamic}" Foreground="{StaticResource PrimaryText}"/>
                                    </ComboBox>
                                </Border>

                                <!-- From Node (Hidden for Moving Mission) -->
                                <Border Background="{StaticResource SurfaceBackground}"
                                       CornerRadius="10"
                                       Margin="0,0,0,12"
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1"
                                       Visibility="{Binding IsNotMovingMission, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <ComboBox SelectedItem="{Binding SelectedFromNodeItem}"
                                             Text="{Binding FromNodeSearchText, UpdateSourceTrigger=PropertyChanged}"
                                             IsDropDownOpen="{Binding IsFromNodeDropDownOpen}"
                                             ItemsSource="{Binding FilteredFromNodes}"
                                             DisplayMemberPath="Name"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Padding="16,12"
                                             IsEditable="True"
                                             IsTextSearchEnabled="False"
                                             StaysOpenOnEdit="True"
                                             materialDesign:HintAssist.Hint="From Node"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <!-- To Node -->
                                <Border Background="{StaticResource SurfaceBackground}"
                                       CornerRadius="10"
                                       Margin="0,0,0,12"
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <ComboBox SelectedItem="{Binding SelectedToNodeItem}"
                                             Text="{Binding ToNodeSearchText, UpdateSourceTrigger=PropertyChanged}"
                                             IsDropDownOpen="{Binding IsToNodeDropDownOpen}"
                                             ItemsSource="{Binding FilteredToNodes}"
                                             DisplayMemberPath="Name"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Padding="16,12"
                                             IsEditable="True"
                                             IsTextSearchEnabled="False"
                                             StaysOpenOnEdit="True"
                                             materialDesign:HintAssist.Hint="To Node"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <!-- Vehicle -->
                                <Border Background="{StaticResource SurfaceBackground}"
                                       CornerRadius="10"
                                       Margin="0,0,0,12"
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <ComboBox SelectedValue="{Binding TemplateVehicle}"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Padding="16,12"
                                             IsEditable="True"
                                             IsTextSearchEnabled="True"
                                             ItemsSource="{Binding Vehicles}"
                                             DisplayMemberPath="Name"
                                             SelectedValuePath="Name"
                                             materialDesign:HintAssist.Hint="Vehicle"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <!-- Priority -->
                                <Border Background="{StaticResource SurfaceBackground}"
                                       CornerRadius="10"
                                       Margin="0,0,0,12"
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <TextBox Text="{Binding TemplatePriority}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Foreground="{StaticResource PrimaryText}"
                                            FontSize="14"
                                            Padding="16,12"
                                            materialDesign:HintAssist.Hint="Priority"
                                            materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <!-- Priority Description -->
                                <Border Background="{StaticResource SurfaceBackground}"
                                       CornerRadius="10"
                                       Margin="0,0,0,16"
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <TextBox Text="{Binding TemplatePriorityDescription}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Foreground="{StaticResource PrimaryText}"
                                            FontSize="14"
                                            Padding="16,12"
                                            materialDesign:HintAssist.Hint="Description"
                                            materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>

                                <!-- Dynamic Mission Configuration (Visible only for Dynamic Mission) -->
                                <StackPanel Visibility="{Binding IsDynamicMission, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="Dynamic Node Configuration" Style="{StaticResource BodyText}" FontWeight="SemiBold" Margin="0,0,0,12"/>

                                    <!-- From Node Config -->
                                    <TextBlock Text="From Node Vars" Style="{StaticResource CaptionText}" Margin="0,0,0,8"/>
                                    <Border Background="{StaticResource DarkBackground}"
                                           CornerRadius="12"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,0,12"
                                           Padding="12">
                                        <StackPanel>
                                            <ItemsControl ItemsSource="{Binding FromNodeVars}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="0,0,0,8">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBox Grid.Column="0" Text="{Binding Key, UpdateSourceTrigger=PropertyChanged}"
                                                                    Margin="0,0,4,0"
                                                                    materialDesign:HintAssist.Hint="Key"/>
                                                            <TextBox Grid.Column="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                                    Margin="4,0,4,0"
                                                                    materialDesign:HintAssist.Hint="Value"/>
                                                            <Button Grid.Column="2" Content="X" Width="30" Height="30"
                                                                   Command="{Binding DataContext.RemoveFromVarCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                                   CommandParameter="{Binding}"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                            <Button Content="Add Var" Command="{Binding AddFromVarCommand}" HorizontalAlignment="Left"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- To Node Config -->
                                    <TextBlock Text="To Node Vars" Style="{StaticResource CaptionText}" Margin="0,0,0,8"/>
                                    <Border Background="{StaticResource DarkBackground}"
                                           CornerRadius="12"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,0,20"
                                           Padding="12">
                                        <StackPanel>
                                            <ItemsControl ItemsSource="{Binding ToNodeVars}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="0,0,0,8">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBox Grid.Column="0" Text="{Binding Key, UpdateSourceTrigger=PropertyChanged}"
                                                                    Margin="0,0,4,0"
                                                                    materialDesign:HintAssist.Hint="Key"/>
                                                            <TextBox Grid.Column="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                                    Margin="4,0,4,0"
                                                                    materialDesign:HintAssist.Hint="Value"/>
                                                            <Button Grid.Column="2" Content="X" Width="30" Height="30"
                                                                   Command="{Binding DataContext.RemoveToVarCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                                   CommandParameter="{Binding}"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                            <Button Content="Add Var" Command="{Binding AddToVarCommand}" HorizontalAlignment="Left"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>

                                <!-- Action Buttons -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                    <Button Content="저장"
                                           Style="{StaticResource ModernPrimaryButton}"
                                           Command="{Binding SaveTemplateCommand}"/>
                                    <Button Content="초기화"
                                           Style="{StaticResource ModernPrimaryButton}"
                                           Command="{Binding ClearTemplateCommand}"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>

                        <!-- Selected Template Actions -->
                        <Border Grid.Row="1"
                                Padding="0, 12, 0, 0"
                                Visibility="{Binding SelectedTemplate, Converter={StaticResource NullToVisibilityConverter}}"
                                MouseLeftButtonDown="TemplateActionBar_MouseLeftButtonDown">
                            <Border Background="{StaticResource DarkBackground}"
                                   CornerRadius="12"
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1"
                                   Padding="12">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <TextBlock Text="선택된 셀: "
                                                   FontSize="12"
                                                  Style="{StaticResource BodyText}"
                                                  FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding SelectedTemplate.Title}"
                                                   FontSize="12"
                                                  Style="{StaticResource BodyText}"
                                                  FontWeight="SemiBold"/>
                                    </StackPanel>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <Button Grid.Column="0"
                                               Content="실행"
                                               Background="{StaticResource SuccessBrush}"
                                               Foreground="White"
                                               BorderThickness="0"
                                               Height="32"
                                               FontWeight="ExtraBold"
                                               FontSize="15"
                                               Margin="0,0,4,0"
                                               Cursor="Hand"
                                               Click="ExecuteTemplate_Click"
                                               Tag="{Binding SelectedTemplate}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#16A34A"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                                <Button Grid.Column="1"
                                       Content="수정"
                                       Background="{StaticResource WarningBrush}"
                                       Foreground="White"
                                       BorderThickness="0"
                                       Height="32"
                                       FontSize="15"
                                       Margin="2,0"
                                       Cursor="Hand"
                                       Click="EditTemplate_Click"
                                       Tag="{Binding SelectedTemplate}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#D97706"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                                <Button Grid.Column="2"
                                       Content="삭제"
                                       Background="{StaticResource ErrorBrush}"
                                       Foreground="White"
                                       BorderThickness="0"
                                       Height="32"
                                       FontSize="15"
                                       Margin="4,0,0,0"
                                       Cursor="Hand"
                                       Click="DeleteTemplate_Click"
                                       Tag="{Binding SelectedTemplate}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#DC2626"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
            
            <!-- Vehicle Management Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Car" Width="18" Height="18" 
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Vehicle Management" 
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Vehicle Control Panel -->
                    <Border Grid.Row="0" Style="{StaticResource GlassCard}" Margin="24,24,24,16">
                        <StackPanel>
                            <!-- Vehicle Commands Section -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Border Background="{StaticResource SurfaceBackground}" 
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <ComboBox SelectedValue="{Binding SelectedVehicle}"
                                             ItemsSource="{Binding Vehicles}"
                                             DisplayMemberPath="Name"
                                             SelectedValuePath="Name"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Width="160"
                                             Padding="12,8"
                                             materialDesign:HintAssist.Hint="Select Vehicle"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>
                                
                                <Border Background="{StaticResource SurfaceBackground}" 
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1"
                                       Margin="12,0,0,0">
                                    <ComboBox SelectedItem="{Binding SelectedInsertNodeItem}"
                                             Text="{Binding InsertNodeSearchText, UpdateSourceTrigger=PropertyChanged}"
                                             IsDropDownOpen="{Binding IsInsertNodeDropDownOpen}"
                                             ItemsSource="{Binding FilteredInsertNodes}"
                                             DisplayMemberPath="Name"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Width="160"
                                             Padding="12,8"
                                             IsEditable="True"
                                             IsTextSearchEnabled="False"
                                             StaysOpenOnEdit="True"
                                             materialDesign:HintAssist.Hint="Insert Node"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>
                                
                                <Button Content="Insert Vehicle" Width="110"
                                       Style="{StaticResource ModernPrimaryButton}"
                                       Command="{Binding InsertVehicleCommand}"
                                       Margin="12,0,0,0"/>
                                
                                <Button Content="Extract Vehicle" Width="110"
                                       Style="{StaticResource ModernPrimaryButton}"
                                       Command="{Binding ExtractVehicleCommand}"/>
                                
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Vehicle List -->
                    <Border Grid.Row="1" Style="{StaticResource GlassCard}" Margin="24,16,24,24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource PrimaryBrush}" 
                                       Width="40" Height="40" 
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="CarMultiple" Width="20" Height="20" 
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Active Vehicles" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="Real-time vehicle status and control" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}" 
                                   CornerRadius="12" 
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid ItemsSource="{Binding VehiclesView}"
                                         Style="{StaticResource AppDataGridStyle}"
                                         RowHeight="45"
                                         ColumnHeaderStyle="{StaticResource CenteredDataGridHeaderStyle}"
                                         CellStyle="{StaticResource CenteredDataGridCellStyle}"
                                         Sorting="VehicleDataGrid_Sorting"
                                         Loaded="VehicleDataGrid_Loaded">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="이름" Binding="{Binding Name}" Width="*" SortMemberPath="Name" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="위치 좌표" Binding="{Binding CoordinatesText}" Width="1.2*" SortMemberPath="CoordinatesText" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="현재위치" Binding="{Binding CurrentNodeName}" Width="1.2*" SortMemberPath="CurrentNodeName" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTemplateColumn Header="배터리" Width="1.2*" SortMemberPath="BatteryLevel">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <Border Background="{StaticResource SurfaceBackground}"
                                                               CornerRadius="10"
                                                               Width="70" Height="20"
                                                               Margin="0,0,8,0">
                                                            <Border Background="{StaticResource SuccessBrush}"
                                                                   CornerRadius="10"
                                                                   HorizontalAlignment="Left"
                                                                   Width="{Binding BatteryLevel, Converter={StaticResource BatteryLevelToWidthConverter}}"/>
                                                        </Border>
                                                        <TextBlock Text="{Binding BatteryLevel, StringFormat={}{0}%}"
                                                                  Foreground="{StaticResource SecondaryText}"
                                                                  FontSize="12"
                                                                  VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="목표노드" Binding="{Binding TargetNode}" Width="1.2*" SortMemberPath="TargetNode" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="차량 상태" Binding="{Binding VehicleStateText}" Width="1.3*" SortMemberPath="VehicleStateText" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                    </DataGrid.Columns>
                                    <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow" BasedOn="{StaticResource AppDataGridRowStyle}">
                                            <Setter Property="Cursor" Value="Hand"/>
                                            <EventSetter Event="MouseDoubleClick" Handler="VehicleRow_DoubleClick"/>
                                        </Style>
                                    </DataGrid.RowStyle>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Alarm Log Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AlertCircle" Width="18" Height="18"
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Alarm Log"
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Filter Panel -->
                    <Border Grid.Row="0" Style="{StaticResource GlassCard}" Margin="24,24,24,16">
                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <!-- Sort Order Filter -->
                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0">
                                        <ComboBox x:Name="AlarmSortOrderCombo"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Width="160"
                                                 Padding="12,8"
                                                 SelectedIndex="0"
                                                 SelectionChanged="AlarmSortOrder_Changed"
                                                 materialDesign:HintAssist.Hint="정렬 순서"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}">
                                            <ComboBoxItem Content="최신순 (내림차순)" Tag="desc" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="오래된순 (오름차순)" Tag="asc" Foreground="{StaticResource PrimaryText}"/>
                                        </ComboBox>
                                    </Border>

                                    <!-- Limit Filter -->
                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0">
                                        <ComboBox x:Name="AlarmLimitCombo"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Width="160"
                                                 Padding="12,8"
                                                 SelectedIndex="2"
                                                 SelectionChanged="AlarmLimit_Changed"
                                                 materialDesign:HintAssist.Hint="표시 개수"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}">
                                            <ComboBoxItem Content="10개" Tag="10" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="25개" Tag="25" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="50개" Tag="50" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="100개" Tag="100" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="200개" Tag="200" Foreground="{StaticResource PrimaryText}"/>
                                        </ComboBox>
                                    </Border>

                                    <Button Content="새로고침" Width="100"
                                           Style="{StaticResource ModernPrimaryButton}"
                                           Command="{Binding RefreshAlarmsCommand}">
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16" Margin="0,0,8,0"/>
                                                    <TextBlock Text="새로고침"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Right">
                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0">
                                        <ComboBox ItemsSource="{Binding AlarmSearchColumns}"
                                                 DisplayMemberPath="DisplayName"
                                                 SelectedValuePath="Key"
                                                 SelectedValue="{Binding SelectedAlarmSearchColumn, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Width="180"
                                                 Padding="12,8"
                                                 materialDesign:HintAssist.Hint="검색 대상"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                    </Border>

                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0"
                                           Width="260">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <materialDesign:PackIcon Grid.Column="0"
                                                                     Kind="Magnify"
                                                                     Width="18" Height="18"
                                                                     Margin="12,0"
                                                                     VerticalAlignment="Center"
                                                                     Foreground="{StaticResource MutedText}"/>
                                            <TextBox Grid.Column="1"
                                                     Text="{Binding AlarmSearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                     Background="Transparent"
                                                     BorderThickness="0"
                                                     Foreground="{StaticResource PrimaryText}"
                                                     Padding="0,8"
                                                     materialDesign:HintAssist.Hint="검색어 입력"
                                                     materialDesign:HintAssist.Foreground="{StaticResource MutedText}"
                                                     VerticalContentAlignment="Center"/>
                                        </Grid>
                                    </Border>

                                    <Button Content="초기화" Width="80"
                                           Style="{StaticResource ModernPrimaryButton}"
                                           Command="{Binding ClearAlarmSearchCommand}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Alarm List -->
                    <Border Grid.Row="1" Style="{StaticResource GlassCard}" Margin="24,16,24,24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource ErrorBrush}"
                                       Width="40" Height="40"
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="Alert" Width="20" Height="20"
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="시스템 알람" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="1초마다 자동 갱신" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>

                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}"
                                   CornerRadius="12"
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid ItemsSource="{Binding AlarmView}"
                                         Style="{StaticResource AppDataGridStyle}"
                                         RowHeight="45"
                                         ColumnHeaderStyle="{StaticResource CenteredDataGridHeaderStyle}"
                                         CellStyle="{StaticResource CenteredDataGridCellStyle}"
                                         Sorting="AlarmDataGrid_Sorting"
                                         Loaded="AlarmDataGrid_Loaded">
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn Header="상태" Width="80" SortMemberPath="State">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding StateColor}"
                                                           CornerRadius="12"
                                                           Padding="10,6"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           >
                                                        <TextBlock Text="{Binding StateText}"
                                                                  Foreground="White"
                                                                  FontSize="12"
                                                                  FontWeight="SemiBold"
                                                                  TextAlignment="Center"/>
                                                    </Border>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="타입" Binding="{Binding SourceTypeText}" Width="100" ElementStyle="{StaticResource CenteredDataGridTextStyle}" SortMemberPath="SourceTypeText"/>
                                        <DataGridTextColumn Header="소스 ID" Binding="{Binding SourceId}" Width="120" ElementStyle="{StaticResource CenteredDataGridTextStyle}" SortMemberPath="SourceId"/>
                                        <DataGridTextColumn Header="이벤트 이름" Binding="{Binding EventDisplayName}" Width="2*" SortMemberPath="EventDisplayName" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="횟수" Binding="{Binding EventCount}" Width="70" ElementStyle="{StaticResource CenteredDataGridTextStyle}" HeaderStyle="{StaticResource CenteredDataGridHeaderStyle}" SortMemberPath="EventCount"/>
                                        <DataGridTextColumn Header="첫 발생 시간" Binding="{Binding FirstEventAtText}" Width="0.8*" SortMemberPath="FirstEventAt" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="마지막 발생" Binding="{Binding LastEventAtText}" Width="0.8*" SortMemberPath="LastEventAt" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Map View Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Map" Width="18" Height="18"
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Map View"
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <views:MapView x:Name="MapViewControl"
                                   MapData="{Binding MapData}"
                                   Vehicles="{Binding Vehicles}"/>
                </Grid>
            </TabItem>
        </TabControl>
        
        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBackground}" CornerRadius="0,0,12,12">
            <Border.Effect>
                <DropShadowEffect Color="Black" Direction="90" ShadowDepth="2" Opacity="0.2" BlurRadius="4"/>
            </Border.Effect>
            <Grid Margin="24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="Information" Width="14" Height="14"
                                           Foreground="{StaticResource MutedText}"
                                           Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding StatusText}"
                              Foreground="{StaticResource SecondaryText}"
                              FontSize="11"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse Width="6" Height="6" Fill="{StaticResource SuccessBrush}" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding ConnectionStatus}"
                              Foreground="{StaticResource SecondaryText}"
                              FontSize="11"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
    </Border>
</Window>
