<Window x:Class="AntMissionManager.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:views="clr-namespace:AntMissionManager.Views"
        Title="ANT Mission Manager"
        Height="900" Width="1400"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">

    <Border CornerRadius="12" Background="{StaticResource DarkBackground}">
        <Border.Effect>
            <DropShadowEffect Color="Black" Direction="270" ShadowDepth="10" Opacity="0.5" BlurRadius="30"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="35"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="{StaticResource CardBackground}" CornerRadius="12,12,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Margin="16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="Robot" Width="16" Height="16" Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="ANT Mission Manager"
                                  FontSize="13"
                                  FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"
                                  VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Content="_"
                               Width="40" Height="30"
                               Background="Transparent"
                               BorderThickness="0"
                               Foreground="{StaticResource MutedText}"
                               FontSize="16"
                               FontWeight="Bold"
                               Cursor="Hand"
                               Click="MinimizeButton_Click"
                               Margin="0,0,4,0">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-8,0,0"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource SurfaceBackground}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button Content="□"
                               Width="40" Height="30"
                               Background="Transparent"
                               BorderThickness="0"
                               Foreground="{StaticResource MutedText}"
                               FontSize="14"
                               FontWeight="Bold"
                               Cursor="Hand"
                               Click="MaximizeButton_Click"
                               Margin="0,0,4,0">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource SurfaceBackground}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button Content="✕"
                               Width="40" Height="30"
                               Background="Transparent"
                               BorderThickness="0"
                               Foreground="{StaticResource MutedText}"
                               FontSize="16"
                               FontWeight="Bold"
                               Cursor="Hand"
                               Click="CloseButton_Click">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

        <!-- Logout Bar -->
        <Border Grid.Row="1" Background="{StaticResource DarkBackground}" Margin="12,0">
            <Grid>
                <Button Content="Logout"
                        Width="100"
                        Height="32"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Center"
                       Style="{StaticResource ModernPrimaryButton}"
                       Command="{Binding LogoutCommand}"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <TabControl Grid.Row="2" 
                   Background="Transparent"
                   Margin="16,3,16,0">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border Name="Border" 
                                       Background="Transparent" 
                                       BorderThickness="0" 
                                       CornerRadius="12,12,0,0"
                                       Margin="0,0,4,0"
                                       Padding="20,12">
                                    <ContentPresenter x:Name="ContentSite"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    ContentSource="Header"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="{StaticResource CardBackground}"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="{StaticResource SurfaceBackground}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>
            
            <!-- Mission Dashboard Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ViewDashboard" Width="18" Height="18" 
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Mission Dashboard" 
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="160"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Control Panel -->
                    <Border Grid.Row="0" Background="{StaticResource SurfaceBackground}" 
                           Padding="24" Margin="0,0,0,16">
                        <StackPanel Orientation="Horizontal">
                            <Border Background="{StaticResource CardBackground}" 
                                   CornerRadius="8" 
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <ComboBox x:Name="MissionStateFilter"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Foreground="{StaticResource PrimaryText}"
                                         Width="180"
                                         Padding="12,8"
                                         materialDesign:HintAssist.Hint="Filter by Status"
                                         materialDesign:HintAssist.Foreground="{StaticResource MutedText}">
                                    <ComboBoxItem Content="All Missions" Foreground="{StaticResource PrimaryText}"/>
                                    <ComboBoxItem Content="Received (0)" Foreground="{StaticResource PrimaryText}"/>
                                    <ComboBoxItem Content="Accepted (1)" Foreground="{StaticResource PrimaryText}"/>
                                    <ComboBoxItem Content="Running (3)" Foreground="{StaticResource PrimaryText}"/>
                                    <ComboBoxItem Content="Completed (4)" Foreground="{StaticResource PrimaryText}"/>
                                    <ComboBoxItem Content="Cancelled (5)" Foreground="{StaticResource PrimaryText}"/>
                                </ComboBox>
                            </Border>
                        </StackPanel>
                    </Border>
                    
                    <!-- Statistics Cards -->
                    <Grid Grid.Row="1" Margin="24,0,24,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Total Missions Card -->
                        <Border Grid.Column="0" Style="{StaticResource GlassCard}" Margin="0,0,8,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Border Background="{StaticResource PrimaryBrush}" 
                                           Width="40" Height="40" 
                                           CornerRadius="20">
                                        <materialDesign:PackIcon Kind="FormatListBulleted" Width="20" Height="20" 
                                                               Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Total" Style="{StaticResource CaptionText}"/>
                                        <TextBlock Text="Missions" Style="{StaticResource CaptionText}" Margin="0,-2,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Row="1" Text="{Binding TotalMissions}" 
                                          FontSize="32" FontWeight="Bold" 
                                          Foreground="{StaticResource PrimaryText}"
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Grid.Row="2" Text="Total missions in system" 
                                          Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            </Grid>
                        </Border>
                        
                        <!-- Running Missions Card -->
                        <Border Grid.Column="1" Style="{StaticResource GlassCard}" Margin="8,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Border Background="{StaticResource SuccessBrush}" 
                                           Width="40" Height="40" 
                                           CornerRadius="20">
                                        <materialDesign:PackIcon Kind="Play" Width="20" Height="20" 
                                                               Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Active" Style="{StaticResource CaptionText}"/>
                                        <TextBlock Text="Running" Style="{StaticResource CaptionText}" Margin="0,-2,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Row="1" Text="{Binding RunningMissions}" 
                                          FontSize="32" FontWeight="Bold" 
                                          Foreground="{StaticResource SuccessBrush}"
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Grid.Row="2" Text="Currently executing" 
                                          Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            </Grid>
                        </Border>
                        
                        <!-- Pending Missions Card -->
                        <Border Grid.Column="2" Style="{StaticResource GlassCard}" Margin="8,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Border Background="{StaticResource WarningBrush}" 
                                           Width="40" Height="40" 
                                           CornerRadius="20">
                                        <materialDesign:PackIcon Kind="Clock" Width="20" Height="20" 
                                                               Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Pending" Style="{StaticResource CaptionText}"/>
                                        <TextBlock Text="Waiting" Style="{StaticResource CaptionText}" Margin="0,-2,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Row="1" Text="{Binding PendingMissions}" 
                                          FontSize="32" FontWeight="Bold" 
                                          Foreground="{StaticResource WarningBrush}"
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Grid.Row="2" Text="Awaiting execution" 
                                          Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            </Grid>
                        </Border>
                        
                        <!-- Completed Missions Card -->
                        <Border Grid.Column="3" Style="{StaticResource GlassCard}" Margin="8,0,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Border Background="{StaticResource AccentBrush}" 
                                           Width="40" Height="40" 
                                           CornerRadius="20">
                                        <materialDesign:PackIcon Kind="CheckCircle" Width="20" Height="20" 
                                                               Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Done" Style="{StaticResource CaptionText}"/>
                                        <TextBlock Text="Completed" Style="{StaticResource CaptionText}" Margin="0,-2,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Grid.Row="1" Text="{Binding CompletedMissions}" 
                                          FontSize="32" FontWeight="Bold" 
                                          Foreground="{StaticResource AccentBrush}"
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Grid.Row="2" Text="Successfully finished" 
                                          Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            </Grid>
                        </Border>
                    </Grid>
                    
                    <!-- Mission List -->
                    <Border Grid.Row="2" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource AccentBrush}" 
                                       Width="40" Height="40" 
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="FormatListBulleted" Width="20" Height="20" 
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Mission Queue" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="Active and pending missions" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}" 
                                   CornerRadius="12" 
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid x:Name="MissionDataGrid"
                                         ItemsSource="{Binding Missions}"
                                         Style="{StaticResource AppDataGridStyle}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Mission ID" Binding="{Binding MissionId}" Width="1.3*"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding MissionType}" Width="0.9*"/>
                                        <DataGridTextColumn Header="From" Binding="{Binding FromNode}" Width="*"/>
                                        <DataGridTextColumn Header="To" Binding="{Binding ToNode}" Width="*"/>
                                        <DataGridTextColumn Header="Vehicle" Binding="{Binding AssignedVehicle}" Width="1.1*"/>
                                        <DataGridTemplateColumn Header="Nav Status" Width="1.3*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding NavigationStateText, Converter={StaticResource NavigationStateToColorConverter}}" 
                                                           CornerRadius="12" 
                                                           Padding="8,4">
                                                        <TextBlock Text="{Binding NavigationStateText}" 
                                                                  Foreground="White"
                                                                  FontSize="11"
                                                                  FontWeight="SemiBold"
                                                                  TextAlignment="Center"/>
                                                    </Border>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Transport" Binding="{Binding TransportStateText}" Width="1.1*"/>
                                        <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="0.8*"/>
                                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt}" Width="1.5*"/>
                                        <DataGridTemplateColumn Header="Actions" Width="*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Cancel" 
                                                           Background="{StaticResource ErrorBrush}"
                                                           Foreground="White"
                                                           BorderThickness="0"
                                                           Height="28"
                                                           Padding="12,4"
                                                           FontSize="11"
                                                           Cursor="Hand"
                                                           Command="{Binding DataContext.CancelMissionCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                           CommandParameter="{Binding MissionId}">
                                                        <Button.Style>
                                                            <Style TargetType="Button">
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate TargetType="Button">
                                                                            <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                            </Border>
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Background" Value="#DC2626"/>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
            
            <!-- Mission Router Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="MapMarker" Width="18" Height="18" 
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Mission Router" 
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="420"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Route Registration -->
                    <Border Grid.Column="0" Style="{StaticResource GlassCard}" Margin="24,24,16,24">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                                <Border Background="{StaticResource SuccessBrush}" 
                                       Width="40" Height="40" 
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="Plus" Width="20" Height="20" 
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Create Route" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="Define mission routes" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Route Name -->
                            <Border Background="{StaticResource SurfaceBackground}" 
                                   CornerRadius="12" 
                                   Margin="0,0,0,16"
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <TextBox Text="{Binding RouteName}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Foreground="{StaticResource PrimaryText}"
                                        FontSize="14"
                                        Padding="16,12"
                                        materialDesign:HintAssist.Hint="Route Name"
                                        materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                            </Border>
                            
                            <!-- Mission Type -->
                            <Border Background="{StaticResource SurfaceBackground}" 
                                   CornerRadius="12" 
                                   Margin="0,0,0,20"
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <ComboBox SelectedValue="{Binding SelectedMissionType}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Foreground="{StaticResource PrimaryText}"
                                         Padding="16,12"
                                         materialDesign:HintAssist.Hint="Mission Type"
                                         materialDesign:HintAssist.Foreground="{StaticResource MutedText}">
                                    <ComboBoxItem Content="Transport" Tag="Transport" Foreground="{StaticResource PrimaryText}"/>
                                    <ComboBoxItem Content="Move" Tag="Move" Foreground="{StaticResource PrimaryText}"/>
                                    <ComboBoxItem Content="PickAndDrop" Tag="PickAndDrop" Foreground="{StaticResource PrimaryText}"/>
                                </ComboBox>
                            </Border>
                            
                            <!-- Nodes Section -->
                            <StackPanel x:Name="NodesPanel">
                                <TextBlock Text="Route Nodes" Style="{StaticResource BodyText}" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Border Grid.Column="0" Background="{StaticResource SurfaceBackground}" 
                                           CornerRadius="12" 
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1">
                                        <ComboBox SelectedValue="{Binding SelectedNode}"
                                                 ItemsSource="{Binding AvailableNodes}"
                                                 DisplayMemberPath="Name"
                                                 SelectedValuePath="Name"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Padding="16,12"
                                                 materialDesign:HintAssist.Hint="Select Node"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                    </Border>
                                    
                                    <Button Grid.Column="1"
                                           Content="Add"
                                           Style="{StaticResource ModernAccentButton}"
                                           Width="70"
                                           Height="44"
                                           Margin="12,0,0,0"
                                           Command="{Binding AddNodeCommand}"/>
                                </Grid>
                                
                                <Border Background="{StaticResource DarkBackground}" 
                                       CornerRadius="12" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1"
                                       Height="140"
                                       Padding="12">
                                    <ListBox ItemsSource="{Binding SelectedNodes}"
                                            Background="Transparent"
                                            BorderThickness="0">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{StaticResource SurfaceBackground}" 
                                                       CornerRadius="8" 
                                                       Padding="12,8" 
                                                       Margin="0,2">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        
                                                        <Border Grid.Column="0" Background="{StaticResource PrimaryBrush}" 
                                                               Width="24" Height="24" 
                                                               CornerRadius="12"
                                                               Margin="0,0,12,0">
                                                            <TextBlock Text="{Binding Index}" 
                                                                      Foreground="White" 
                                                                      FontSize="12" FontWeight="Bold"
                                                                      TextAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                        </Border>
                                                        
                                                        <TextBlock Grid.Column="1" Text="{Binding NodeName}" 
                                                                  Foreground="{StaticResource PrimaryText}"
                                                                  VerticalAlignment="Center"
                                                                  FontSize="13"/>
                                                        
                                                        <Button Grid.Column="2" 
                                                               Width="24" Height="24"
                                                               Background="Transparent"
                                                               BorderThickness="0"
                                                               Cursor="Hand"
                                                               Command="{Binding DataContext.RemoveNodeCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                               CommandParameter="{Binding}">
                                                            <materialDesign:PackIcon Kind="Close" Width="12" Height="12" Foreground="{StaticResource ErrorBrush}"/>
                                                        </Button>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </Border>
                            </StackPanel>
                            
                            <!-- Action Buttons -->
                            <StackPanel Orientation="Horizontal" Margin="0,24,0,16">
                                <Button Content="Save Route" 
                                       Style="{StaticResource ModernPrimaryButton}"
                                       Command="{Binding SaveRouteCommand}"/>
                                <Button Content="Clear" 
                                       Style="{StaticResource ModernSecondaryButton}"
                                       Command="{Binding ClearRouteCommand}"/>
                            </StackPanel>
                            
                            <Border Height="1" Background="{StaticResource BorderBrush}" Margin="0,16"/>
                            
                            <!-- Import/Export -->
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Import" 
                                       Style="{StaticResource ModernSecondaryButton}"
                                       Command="{Binding ImportRoutesCommand}"/>
                                <Button Content="Export" 
                                       Style="{StaticResource ModernSecondaryButton}"
                                       Command="{Binding ExportRoutesCommand}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Route List -->
                    <Border Grid.Column="1" Style="{StaticResource GlassCard}" Margin="16,24,24,24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource AccentBrush}" 
                                       Width="40" Height="40" 
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="Routes" Width="20" Height="20" 
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Registered Routes" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="Manage mission route configurations" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}" 
                                   CornerRadius="12" 
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid ItemsSource="{Binding Routes}"
                                         Style="{StaticResource AppDataGridStyle}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="1.5*"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding MissionType}" Width="*"/>
                                        <DataGridTextColumn Header="Node Path" Binding="{Binding NodesPath}" Width="3*"/>
                                        <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="0.8*"/>
                                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt}" Width="1.4*"/>
                                        <DataGridTemplateColumn Header="Actions" Width="1.2*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Button Content="Edit" 
                                                               Style="{StaticResource ModernSecondaryButton}"
                                                               Height="28"
                                                               Padding="12,4"
                                                               FontSize="11"
                                                               Margin="0,0,4,0"
                                                               Click="EditRoute_Click"
                                                               Tag="{Binding}"/>
                                                        <Button Content="Delete" 
                                                               Background="{StaticResource ErrorBrush}"
                                                               Foreground="White"
                                                               BorderThickness="0"
                                                               Height="28"
                                                               Padding="12,4"
                                                               FontSize="11"
                                                               Cursor="Hand"
                                                               Click="DeleteRoute_Click"
                                                               Tag="{Binding}">
                                                            <Button.Style>
                                                                <Style TargetType="Button">
                                                                    <Setter Property="Template">
                                                                        <Setter.Value>
                                                                            <ControlTemplate TargetType="Button">
                                                                                <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                                </Border>
                                                                            </ControlTemplate>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                    <Style.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="#DC2626"/>
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Button.Style>
                                                        </Button>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
            
            <!-- Vehicle Management Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Car" Width="18" Height="18" 
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Vehicle Management" 
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Vehicle Control Panel -->
                    <Border Grid.Row="0" Style="{StaticResource GlassCard}" Margin="24,24,24,16">
                        <StackPanel>
                            <!-- Vehicle Commands Section -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Border Background="{StaticResource SurfaceBackground}" 
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1">
                                    <ComboBox SelectedValue="{Binding SelectedVehicle}"
                                             ItemsSource="{Binding Vehicles}"
                                             DisplayMemberPath="Name"
                                             SelectedValuePath="Name"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Width="160"
                                             Padding="12,8"
                                             materialDesign:HintAssist.Hint="Select Vehicle"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>
                                
                                <Border Background="{StaticResource SurfaceBackground}" 
                                       CornerRadius="8" 
                                       BorderBrush="{StaticResource BorderBrush}"
                                       BorderThickness="1"
                                       Margin="12,0,0,0">
                                    <ComboBox SelectedValue="{Binding SelectedInsertNode}"
                                             ItemsSource="{Binding AvailableNodes}"
                                             DisplayMemberPath="Name"
                                             SelectedValuePath="Name"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource PrimaryText}"
                                             Width="160"
                                             Padding="12,8"
                                             materialDesign:HintAssist.Hint="Insert Node"
                                             materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                </Border>
                                
                                <Button Content="Insert Vehicle" 
                                       Style="{StaticResource ModernPrimaryButton}"
                                       Command="{Binding InsertVehicleCommand}"
                                       Margin="12,0,0,0"/>
                                
                                <Button Content="Extract Vehicle" 
                                       Style="{StaticResource ModernSecondaryButton}"
                                       Command="{Binding ExtractVehicleCommand}"/>
                                
                                <Button Content="Refresh Vehicles" 
                                       Style="{StaticResource ModernAccentButton}"
                                       Command="{Binding RefreshVehiclesCommand}"/>
                                
                                <Button Content="Refresh Nodes" 
                                       Style="{StaticResource ModernAccentButton}"
                                       Command="{Binding RefreshNodesCommand}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Vehicle List -->
                    <Border Grid.Row="1" Style="{StaticResource GlassCard}" Margin="24,16,24,24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource PrimaryBrush}" 
                                       Width="40" Height="40" 
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="CarMultiple" Width="20" Height="20" 
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Active Vehicles" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="Real-time vehicle status and control" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}" 
                                   CornerRadius="12" 
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid ItemsSource="{Binding Vehicles}"
                                         Style="{StaticResource AppDataGridStyle}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="이름" Binding="{Binding Name}" Width="*"/>
                                        <DataGridTextColumn Header="위치 좌표" Binding="{Binding CoordinatesText}" Width="1.2*"/>
                                        <DataGridTextColumn Header="현재위치" Binding="{Binding CurrentNodeName}" Width="1.2*"/>
                                        <DataGridTemplateColumn Header="배터리" Width="1.2*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Border Background="{StaticResource SurfaceBackground}" 
                                                               CornerRadius="10" 
                                                               Width="70" Height="20"
                                                               Margin="0,0,8,0">
                                                            <Border Background="{StaticResource SuccessBrush}" 
                                                                   CornerRadius="10"
                                                                   HorizontalAlignment="Left"
                                                                   Width="{Binding BatteryLevel, Converter={StaticResource BatteryLevelToWidthConverter}}"/>
                                                        </Border>
                                                        <TextBlock Text="{Binding BatteryLevel, StringFormat={}{0}%}" 
                                                                  Foreground="{StaticResource SecondaryText}"
                                                                  FontSize="12"
                                                                  VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="목표노드" Binding="{Binding TargetNode}" Width="1.2*"/>
                                        <DataGridTextColumn Header="차량 상태" Binding="{Binding VehicleStateText}" Width="1.3*"/>
                                    </DataGrid.Columns>
                                    <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow" BasedOn="{StaticResource AppDataGridRowStyle}">
                                            <Setter Property="Cursor" Value="Hand"/>
                                            <EventSetter Event="MouseDoubleClick" Handler="VehicleRow_DoubleClick"/>
                                        </Style>
                                    </DataGrid.RowStyle>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Alarm Log Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AlertCircle" Width="18" Height="18"
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Alarm Log"
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Filter Panel -->
                    <Border Grid.Row="0" Style="{StaticResource GlassCard}" Margin="24,24,24,16">
                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <!-- Sort Order Filter -->
                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0">
                                        <ComboBox x:Name="AlarmSortOrderCombo"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Width="160"
                                                 Padding="12,8"
                                                 SelectedIndex="0"
                                                 SelectionChanged="AlarmSortOrder_Changed"
                                                 materialDesign:HintAssist.Hint="정렬 순서"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}">
                                            <ComboBoxItem Content="최신순 (내림차순)" Tag="desc" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="오래된순 (오름차순)" Tag="asc" Foreground="{StaticResource PrimaryText}"/>
                                        </ComboBox>
                                    </Border>

                                    <!-- Limit Filter -->
                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0">
                                        <ComboBox x:Name="AlarmLimitCombo"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Width="160"
                                                 Padding="12,8"
                                                 SelectedIndex="2"
                                                 SelectionChanged="AlarmLimit_Changed"
                                                 materialDesign:HintAssist.Hint="표시 개수"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}">
                                            <ComboBoxItem Content="10개" Tag="10" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="25개" Tag="25" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="50개" Tag="50" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="100개" Tag="100" Foreground="{StaticResource PrimaryText}"/>
                                            <ComboBoxItem Content="200개" Tag="200" Foreground="{StaticResource PrimaryText}"/>
                                        </ComboBox>
                                    </Border>

                                    <Button Content="새로고침"
                                           Style="{StaticResource ModernPrimaryButton}"
                                           Command="{Binding RefreshAlarmsCommand}">
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16" Margin="0,0,8,0"/>
                                                    <TextBlock Text="새로고침"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Right">
                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0">
                                        <ComboBox ItemsSource="{Binding AlarmSearchColumns}"
                                                 DisplayMemberPath="DisplayName"
                                                 SelectedValuePath="Key"
                                                 SelectedValue="{Binding SelectedAlarmSearchColumn, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Foreground="{StaticResource PrimaryText}"
                                                 Width="180"
                                                 Padding="12,8"
                                                 materialDesign:HintAssist.Hint="검색 대상"
                                                 materialDesign:HintAssist.Foreground="{StaticResource MutedText}"/>
                                    </Border>

                                    <Border Background="{StaticResource SurfaceBackground}"
                                           CornerRadius="8"
                                           BorderBrush="{StaticResource BorderBrush}"
                                           BorderThickness="1"
                                           Margin="0,0,12,0"
                                           Width="260">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <materialDesign:PackIcon Grid.Column="0"
                                                                     Kind="Magnify"
                                                                     Width="18" Height="18"
                                                                     Margin="12,0"
                                                                     VerticalAlignment="Center"
                                                                     Foreground="{StaticResource MutedText}"/>
                                            <TextBox Grid.Column="1"
                                                     Text="{Binding AlarmSearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                     Background="Transparent"
                                                     BorderThickness="0"
                                                     Foreground="{StaticResource PrimaryText}"
                                                     Padding="0,8"
                                                     materialDesign:HintAssist.Hint="검색어 입력"
                                                     materialDesign:HintAssist.Foreground="{StaticResource MutedText}"
                                                     VerticalContentAlignment="Center"/>
                                        </Grid>
                                    </Border>

                                    <Button Content="초기화"
                                           Style="{StaticResource ModernSecondaryButton}"
                                           Command="{Binding ClearAlarmSearchCommand}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Alarm List -->
                    <Border Grid.Row="1" Style="{StaticResource GlassCard}" Margin="24,16,24,24">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource ErrorBrush}"
                                       Width="40" Height="40"
                                       CornerRadius="20"
                                       Margin="0,0,12,0">
                                    <materialDesign:PackIcon Kind="Alert" Width="20" Height="20"
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="시스템 알람" Style="{StaticResource SubheadingText}" Margin="0,0,0,4"/>
                                    <TextBlock Text="1초마다 자동 갱신" Style="{StaticResource CaptionText}" Margin="0"/>
                                </StackPanel>
                            </StackPanel>

                            <Border Grid.Row="1" Background="{StaticResource DarkBackground}"
                                   CornerRadius="12"
                                   BorderBrush="{StaticResource BorderBrush}"
                                   BorderThickness="1">
                                <DataGrid ItemsSource="{Binding AlarmView}"
                                         Style="{StaticResource AppDataGridStyle}"
                                         RowHeight="45"
                                         ColumnHeaderStyle="{StaticResource CenteredDataGridHeaderStyle}"
                                         CellStyle="{StaticResource CenteredDataGridCellStyle}"
                                         Sorting="AlarmDataGrid_Sorting"
                                         Loaded="AlarmDataGrid_Loaded">
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn Header="상태" Width="80" SortMemberPath="State">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding StateColor}"
                                                           CornerRadius="12"
                                                           Padding="10,6"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           >
                                                        <TextBlock Text="{Binding StateText}"
                                                                  Foreground="White"
                                                                  FontSize="12"
                                                                  FontWeight="SemiBold"
                                                                  TextAlignment="Center"/>
                                                    </Border>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="타입" Binding="{Binding SourceTypeText}" Width="100" ElementStyle="{StaticResource CenteredDataGridTextStyle}" SortMemberPath="SourceTypeText"/>
                                        <DataGridTextColumn Header="소스 ID" Binding="{Binding SourceId}" Width="120" ElementStyle="{StaticResource CenteredDataGridTextStyle}" SortMemberPath="SourceId"/>
                                        <DataGridTextColumn Header="이벤트 이름" Binding="{Binding EventDisplayName}" Width="2*" SortMemberPath="EventDisplayName" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="횟수" Binding="{Binding EventCount}" Width="70" ElementStyle="{StaticResource CenteredDataGridTextStyle}" HeaderStyle="{StaticResource CenteredDataGridHeaderStyle}" SortMemberPath="EventCount"/>
                                        <DataGridTextColumn Header="첫 발생 시간" Binding="{Binding FirstEventAtText}" Width="0.8*" SortMemberPath="FirstEventAt" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                        <DataGridTextColumn Header="마지막 발생" Binding="{Binding LastEventAtText}" Width="0.8*" SortMemberPath="LastEventAt" ElementStyle="{StaticResource CenteredDataGridTextStyle}"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Map View Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Map" Width="18" Height="18"
                                               Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                        <TextBlock Text="Map View"
                                  FontSize="14" FontWeight="SemiBold"
                                  Foreground="{StaticResource PrimaryText}"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="0" Background="{StaticResource CardBackground}">
                    <views:MapView x:Name="MapViewControl"
                                   MapData="{Binding MapData}"
                                   Vehicles="{Binding Vehicles}"/>
                </Grid>
            </TabItem>
        </TabControl>
        
        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBackground}" CornerRadius="0,0,12,12">
            <Border.Effect>
                <DropShadowEffect Color="Black" Direction="90" ShadowDepth="2" Opacity="0.2" BlurRadius="4"/>
            </Border.Effect>
            <Grid Margin="24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="Information" Width="14" Height="14"
                                           Foreground="{StaticResource MutedText}"
                                           Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding StatusText}"
                              Foreground="{StaticResource SecondaryText}"
                              FontSize="11"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse Width="6" Height="6" Fill="{StaticResource SuccessBrush}" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding ConnectionStatus}"
                              Foreground="{StaticResource SecondaryText}"
                              FontSize="11"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
    </Border>
</Window>
